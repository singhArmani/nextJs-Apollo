// ref: https://github.com/apollographql/apollo-server/issues/1633
const ObjectId = require('mongodb').ObjectId;
ObjectId.prototype.valueOf = function () {
	return this.toString();
};

const typeDefs = `
    type Link {
        _id: String # mongoDb autogenerated id
        title: String
        url: String
    }

    type Store {
        links : [Link]
    }

    # the schema allows the following query: 
    type Query {
        store: Store
        link(id: ID!): [Link]
    }

    # we need to tell the server which types represent the root query
    # and root mutation types. We call them RootQuery and RootMutation by convention.
    schema {
        query: Query
    }
`

// db is the mongo db object
function getResolver(db) {
        const resolvers = {
        Query: {
            store() {
                return ({});
            },
            link(root, args){
                return db.collection('links').find({"_id": ObjectId(args.id)}).toArray()
            }
        },
        Store: {
            links() {
                return db.collection('links').find({}).toArray()
            }
        },

    }
    return resolvers
}

module.exports = {
    typeDefs,
    getResolver
}
